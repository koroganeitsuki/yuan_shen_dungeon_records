<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸç¥å¹½å¢ƒå±æˆ˜éš¾åº¦å…­ - é€šå…³æ’è¡Œæ¦œ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <!-- è‡ªå®šä¹‰Tailwindé…ç½® -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7928ca',
                        secondary: '#ff0080',
                        accent: '#ffdd40',
                        dark: '#121212',
                        light: '#f5f5f5',
                        'genshin-purple': '#7928ca',
                        'genshin-blue': '#3b82f6',
                        'genshin-pink': '#ec4899',
                        'genshin-yellow': '#fbbf24',
                        'genshin-green': '#10b981',
                        'genshin-red': '#ef4444',
                        'genshin-gray': '#6b7280',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            background-color: #121212;
            color: #f5f5f5;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(121, 40, 202, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(255, 0, 128, 0.1) 0%, transparent 50%);
            background-attachment: fixed;
        }
        
        .bg-gradient-genshin {
            background: linear-gradient(135deg, #7928ca, #ff0080);
        }
        
        .text-shadow {
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .card {
            background: rgba(18, 18, 18, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 221, 64, 0.5);
        }
        
        .btn-genshin {
            background: linear-gradient(135deg, #7928ca, #ff0080);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .btn-genshin:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            background: linear-gradient(135deg, #ff0080, #7928ca);
        }
        
        .btn-genshin:active {
            transform: translateY(0);
        }
        
        .btn-outline {
            background: transparent;
            color: #f5f5f5;
            padding: 0.5rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
        }
        
        .btn-outline:hover {
            border-color: #fbbf24;
            color: #fbbf24;
        }
        
        .input-genshin {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            color: #f5f5f5;
            transition: all 0.3s ease;
        }
        
        .input-genshin:focus {
            border-color: #fbbf24;
            outline: none;
            box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.2);
        }
        
        .select-genshin {
            background: #1e1e1e;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            color: #ffffff;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23ffffff'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1rem;
            padding-right: 2.5rem;
        }
        
        .select-genshin:focus {
            border-color: #fbbf24;
            outline: none;
            box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.2);
        }
        
        .table-genshin {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 0.5rem;
            overflow: hidden;
        }
        
        .table-genshin th {
            background: rgba(121, 40, 202, 0.2);
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 600;
            color: #f5f5f5;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .table-genshin td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .table-genshin tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .table-genshin tr:last-child td {
            border-bottom: none;
        }
        
        .sortable-header {
            cursor: pointer;
            position: relative;
            padding-right: 1.5rem;
        }
        
        .sortable-header::after {
            content: '';
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
        }
        
        .sortable-header.asc::after {
            border-bottom: 6px solid #fbbf24;
        }
        
        .sortable-header.desc::after {
            border-top: 6px solid #fbbf24;
        }
        
        .avatar-sm {
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .avatar-md {
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-gold {
            background-color: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.4);
        }
        
        .badge-time {
            background-color: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.4);
        }
        
        .badge-fast {
            background-color: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.4);
        }
        
        .badge-slow {
            background-color: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.4);
        }
        
        .pagination-btn {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .pagination-btn:hover {
            border-color: #fbbf24;
            color: #fbbf24;
        }
        
        .pagination-btn.active {
            background-color: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border-color: #fbbf24;
        }
        
        .loading {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fbbf24;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .team-avatars {
            display: flex;
            gap: -1rem;
        }
        
        .team-avatars .avatar-sm {
            border: 2px solid #121212;
        }
        
        .team-avatars .avatar-sm:not(:first-child) {
            margin-left: -1rem;
        }
        
        .stat-card {
            background: rgba(18, 18, 18, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 221, 64, 0.3);
        }
        
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .responsive-table {
                overflow-x: auto;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body class="font-sans">
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-dark bg-opacity-80 backdrop-blur-md border-b border-gray-800 sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="flex items-center space-x-2">
                        <img src="https://bbs-static.miyoushe.com/static/2025/06/16/46c0ca54ffaa4664f05efe7932d0bdfb_4298836572782376517.png" alt="åŸç¥å¹½å¢ƒå±æˆ˜" class="w-8 h-8">
                        <span class="text-xl font-bold text-genshin-yellow">åŸç¥å¹½å¢ƒå±æˆ˜</span>
                    </a>
                    <span class="text-gray-400 text-sm">éš¾åº¦å…­é€šå…³è®°å½•</span>
                </div>
                
                <div class="hidden md:flex items-center space-x-6">
                    <a href="index.html" class="text-gray-400 hover:text-genshin-yellow transition-colors">é¦–é¡µ</a>
                    <a href="ranking.html" class="text-genshin-yellow font-medium">æ’è¡Œæ¦œ</a>
                    <a href="upload.html" class="text-gray-400 hover:text-genshin-yellow transition-colors">ä¸Šä¼ è®°å½•</a>
                    <a href="admin.html" class="text-gray-400 hover:text-genshin-yellow transition-colors">ç®¡ç†å‘˜</a>
                </div>
                
                <div class="md:hidden">
                    <button id="mobile-menu-btn" class="text-gray-400 hover:text-genshin-yellow">
                        <i class="fa fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ç§»åŠ¨ç«¯èœå• -->
        <div id="mobile-menu" class="md:hidden bg-dark bg-opacity-95 backdrop-blur-md border-b border-gray-800 hidden">
            <div class="container mx-auto px-4 py-2">
                <div class="flex flex-col space-y-3 py-3">
                    <a href="index.html" class="text-gray-400 hover:text-genshin-yellow transition-colors py-2">é¦–é¡µ</a>
                    <a href="ranking.html" class="text-genshin-yellow font-medium py-2">æ’è¡Œæ¦œ</a>
                    <a href="upload.html" class="text-gray-400 hover:text-genshin-yellow transition-colors py-2">ä¸Šä¼ è®°å½•</a>
                    <a href="admin.html" class="text-gray-400 hover:text-genshin-yellow transition-colors py-2">ç®¡ç†å‘˜</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="container mx-auto px-4 py-8">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-genshin-yellow mb-2 text-shadow">å¹½å¢ƒå±æˆ˜éš¾åº¦å…­ Â· é€šå…³æ’è¡Œæ¦œ</h1>
            <p class="text-gray-400 max-w-2xl mx-auto">è®°å½•ç©å®¶ä»¬çš„ç²¾å½©æˆ˜æ–—ï¼Œåˆ†äº«æœ€ä¼˜é€šå…³ç­–ç•¥</p>
        </div>
        
        <!-- åŠ è½½çŠ¶æ€ -->
        <div id="loading-container" class="flex flex-col items-center justify-center py-16">
            <div class="loading mb-4"></div>
            <p class="text-lg text-gray-400">æ­£åœ¨åŠ è½½æ•°æ®...</p>
        </div>
        
        <!-- å†…å®¹å®¹å™¨ (åˆå§‹éšè—) -->
        <div id="content-container" class="hidden">
            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8 stats-grid">
                <div class="stat-card fade-in">
                    <div class="text-gray-400 text-sm mb-1">æ€»é€šå…³è®°å½•</div>
                    <div class="flex items-end">
                        <span id="total-records" class="text-3xl font-bold text-genshin-yellow">0</span>
                        <span class="text-gray-400 ml-1 mb-1">æ¡</span>
                    </div>
                    <div class="mt-2 text-xs text-gray-500">æ•°æ®æ›´æ–°æ—¶é—´: <span id="update-time">2025-11-14</span></div>
                </div>
                
                <div class="stat-card fade-in" style="animation-delay: 0.1s;">
                    <div class="text-gray-400 text-sm mb-1">å‚ä¸ç©å®¶</div>
                    <div class="flex items-end">
                        <span id="total-players" class="text-3xl font-bold text-genshin-blue">0</span>
                        <span class="text-gray-400 ml-1 mb-1">äºº</span>
                    </div>
                    <div class="mt-2 text-xs text-gray-500">å¹³å‡æ¯äººé€šå…³ <span id="avg-records-per-player">0</span> æ¬¡</div>
                </div>
                
                <div class="stat-card fade-in" style="animation-delay: 0.2s;">
                    <div class="text-gray-400 text-sm mb-1">BOSSæ•°é‡</div>
                    <div class="flex items-end">
                        <span id="total-bosses" class="text-3xl font-bold text-genshin-pink">0</span>
                        <span class="text-gray-400 ml-1 mb-1">ä¸ª</span>
                    </div>
                    <div class="mt-2 text-xs text-gray-500">æœ€éš¾BOSS: <span id="hardest-boss">-</span></div>
                </div>
                
                <div class="stat-card fade-in" style="animation-delay: 0.3s;">
                    <div class="text-gray-400 text-sm mb-1">å¹³å‡é€šå…³æ—¶é—´</div>
                    <div class="flex items-end">
                        <span id="avg-time" class="text-3xl font-bold text-genshin-green">0</span>
                        <span class="text-gray-400 ml-1 mb-1">ç§’</span>
                    </div>
                    <div class="mt-2 text-xs text-gray-500">æœ€å¿«è®°å½•: <span id="fastest-time">-</span> ç§’</div>
                </div>
            </div>
            
            <!-- ç­›é€‰å’Œæœç´¢ -->
            <div class="card p-6 mb-8 fade-in" style="animation-delay: 0.4s;">
                <h2 class="text-xl font-bold mb-4">ç­›é€‰æ¡ä»¶</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">BOSS</label>
                        <select id="boss-filter" class="select-genshin w-full">
                            <option value="all">å…¨éƒ¨BOSS</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">ä¸»Cè§’è‰²</label>
                        <select id="mainc-filter" class="select-genshin w-full">
                            <option value="all">å…¨éƒ¨ä¸»C</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">é™å®šé‡‘æ•°</label>
                        <div class="flex items-center space-x-2">
                            <input type="number" id="gold-min" class="input-genshin w-full" placeholder="æœ€å°å€¼" min="0" max="48" value="0">
                            <span class="text-gray-400">åˆ°</span>
                            <input type="number" id="gold-max" class="input-genshin w-full" placeholder="æœ€å¤§å€¼" min="0" max="48" value="48">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">é€šå…³æ—¶é—´</label>
                        <div class="flex items-center space-x-2">
                            <input type="number" id="time-min" class="input-genshin w-full" placeholder="æœ€å°å€¼" min="0" max="360" value="0">
                            <span class="text-gray-400">åˆ°</span>
                            <input type="number" id="time-max" class="input-genshin w-full" placeholder="æœ€å¤§å€¼" min="0" max="360" value="360">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">æœç´¢ç©å®¶</label>
                        <div class="relative">
                            <input type="text" id="search-input" class="input-genshin w-full pl-9" placeholder="è¾“å…¥ç©å®¶åç§°...">
                            <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">è®°å½•çŠ¶æ€</label>
                        <select id="status-filter" class="select-genshin w-full">
                            <option value="approved">å·²å®¡æ ¸è®°å½•</option>
                            <option value="all">å…¨éƒ¨è®°å½•</option>
                            <option value="pending">æœªå®¡æ ¸è®°å½•</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">æ¯èµ›</label>
                        <select id="cup-filter" class="select-genshin w-full">
                            <option value="all">å…¨éƒ¨æ¯èµ›</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">ä¸»Cè®°å½•</label>
                        <select id="mainc-record-filter" class="select-genshin w-full">
                            <option value="all">æ˜¾ç¤ºå…¨éƒ¨è®°å½•</option>
                            <option value="best">æ¯ä¸ªä¸»Cåªæ˜¾ç¤ºæœ€ä¼˜è®°å½•</option>
                        </select>
                    </div>
                </div>
                
                <div class="mt-6 flex justify-end">
                    <button id="reset-filter" class="btn-outline mr-3">
                        <i class="fa fa-refresh mr-1"></i> é‡ç½®
                    </button>
                    <button id="apply-filter" class="btn-genshin">
                        <i class="fa fa-filter mr-1"></i> åº”ç”¨ç­›é€‰
                    </button>
                </div>
                <div class="mt-4 text-xs text-gray-500">
                    <div class="flex items-center justify-center">
                        <div class="flex items-center mr-6">
                            <div class="inline-block w-3 h-3 bg-genshin-yellow rounded-full mr-1"></div>
                            <span>å‘½åº§ç­‰çº§</span>
                        </div>
                        <div class="flex items-center">
                            <div class="inline-block w-3 h-3 bg-genshin-blue rounded-full mr-1"></div>
                            <span>æ­¦å™¨ç²¾ç‚¼ç­‰çº§</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ•°æ®å±•ç¤ºåŒº -->
            <div class="grid grid-cols-1 gap-8">
                <!-- æ’è¡Œæ¦œè¡¨æ ¼ -->
                <div class="card p-6 fade-in" style="animation-delay: 0.5s;">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">é€šå…³è®°å½•</h2>
                        <div class="flex items-center">
                            <span class="text-sm text-gray-400 mr-2">æ’åºæ–¹å¼:</span>
                            <select id="sort-select" class="select-genshin text-sm py-1">
                                <option value="time-asc">é€šå…³æ—¶é—´ (å¿«â†’æ…¢)</option>
                                <option value="time-desc">é€šå…³æ—¶é—´ (æ…¢â†’å¿«)</option>
                                <option value="gold-desc">é™å®šé‡‘æ•° (å¤šâ†’å°‘)</option>
                                <option value="gold-asc" selected>é™å®šé‡‘æ•° (å°‘â†’å¤š)</option>
                                <option value="date-desc">æäº¤æ—¶é—´ (æ–°â†’æ—§)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="responsive-table">
                        <table class="table-genshin">
                            <thead>
                                <tr>
                                    <th class="w-12">#</th>
                                    <th class="sortable-header" data-sort="player">ç©å®¶</th>
                                    <th class="sortable-header" data-sort="mainc">ä¸»C</th>
                                    <th>é˜Ÿä¼é…ç½®</th>
                                    <th class="sortable-header" data-sort="gold">é™å®šé‡‘</th>
                                    <th class="sortable-header" data-sort="constgold">å¸¸é©»é‡‘</th>
                                    <th class="sortable-header" data-sort="time">é€šå…³æ—¶é—´</th>
                                    <th class="sortable-header" data-sort="boss">BOSS</th>
                                    <th>å¤‡æ³¨</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="records-table-body">
                                <!-- è¡¨æ ¼å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- åˆ†é¡µ -->
                    <div class="mt-6 flex justify-between items-center">
                        <div class="text-sm text-gray-400">
                            æ˜¾ç¤º <span id="showing-records">0</span> æ¡è®°å½•ï¼Œå…± <span id="filtered-records-count">0</span> æ¡
                        </div>
                        <div class="flex items-center space-x-2">
                            <button id="prev-page" class="pagination-btn" disabled>
                                <i class="fa fa-chevron-left"></i>
                            </button>
                            <div id="pagination-buttons" class="flex items-center space-x-1">
                                <!-- é¡µç æŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                            <button id="next-page" class="pagination-btn" disabled>
                                <i class="fa fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- å›¾è¡¨å’Œç»Ÿè®¡ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- BOSSé€šå…³æ¬¡æ•°åˆ†å¸ƒ -->
                    <div class="card p-6 fade-in" style="animation-delay: 0.6s;">
                        <h2 class="text-xl font-bold mb-4">BOSSé€šå…³æ¬¡æ•°</h2>
                        <div class="chart-container">
                            <canvas id="boss-chart"></canvas>
                        </div>
                    </div>
                    
                    <!-- ä¸»Cä½¿ç”¨ç‡ -->
                    <div class="card p-6 fade-in" style="animation-delay: 0.7s;">
                        <h2 class="text-xl font-bold mb-4">ä¸»Cä½¿ç”¨ç‡</h2>
                        <div class="chart-container">
                            <canvas id="mainc-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ— æ•°æ®æç¤º -->
        <div id="no-data-container" class="hidden flex flex-col items-center justify-center py-16 text-center">
            <div class="text-6xl text-gray-700 mb-4">
                <i class="fa fa-frown-o"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2">æš‚æ— æ•°æ®</h2>
            <p class="text-gray-400 max-w-md mx-auto">å½“å‰ç­›é€‰æ¡ä»¶ä¸‹æ²¡æœ‰æ‰¾åˆ°é€šå…³è®°å½•ï¼Œè¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–ä¸Šä¼ æ–°çš„è®°å½•ã€‚</p>
            <a href="upload.html" class="btn-genshin mt-6">
                <i class="fa fa-upload mr-1"></i> ä¸Šä¼ é€šå…³è®°å½•
            </a>
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer class="py-8 bg-dark border-t border-gray-800 mt-16">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p class="text-gray-400">&copy; 2025 åŸç¥å¹½å¢ƒå±æˆ˜éš¾åº¦å…­é€šå…³è®°å½•. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
                </div>
                <div class="flex space-x-4">
                    <a href="https://space.bilibili.com/435511059" target="_blank" class="text-gray-400 hover:text-genshin-yellow">
                        <i class="fab fa-bilibili text-2xl"></i>
                    </a>
                </div>
            </div>
            <div class="mt-4 text-center text-gray-500 text-sm">
                <p>æœ¬ç½‘ç«™ä»…ç”¨äºè®°å½•å’Œåˆ†äº«æ¸¸æˆé€šå…³è®°å½•ï¼Œä¸miHoYo/HoYoverseæ— å…³</p>
            </div>
        </div>
    </footer>

    <!-- å¼•ç”¨æ•°æ®æ–‡ä»¶ -->
    <script src="records.js"></script>
    <script src="data.js"></script>

    <!-- JavaScript -->
    <script>
        // ç§»åŠ¨ç«¯èœå•
        document.getElementById('mobile-menu-btn').addEventListener('click', function() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });
        
        // å¯¼èˆªé“¾æ¥ç‚¹å‡»å…³é—­èœå•
        document.querySelectorAll('#mobile-menu a').forEach(link => {
            link.addEventListener('click', function() {
                document.getElementById('mobile-menu').classList.add('hidden');
            });
        });
        
        // å…¨å±€å˜é‡
        let currentPage = 1;
        const recordsPerPage = 10;
        let allRecords = [];
        let filteredRecords = [];
        let sortField = 'gold';
        let sortDirection = 'asc';
        let maincRecordFilter = 'all';
        
        // è·å–è§’è‰²å¤´åƒURL
        function getCharacterAvatarUrl(characterName) {
            // åœ¨DataStoreä¸­æŸ¥æ‰¾è§’è‰²
            const character = DataStore.characters.find(char => char.name === characterName);
            return character ? character.avatar : 'https://via.placeholder.com/40';
        }
        
        // è·å–BOSSå¤´åƒURL
        function getBossAvatarUrl(bossName) {
            // åœ¨DataStoreä¸­æŸ¥æ‰¾BOSS
            const boss = DataStore.bosses.find(b => b.name === bossName);
            return boss ? boss.avatar : 'https://via.placeholder.com/40';
        }
        
        // è·å–å…ƒç´ é¢œè‰²
        function getElementColor(elementType) {
            return DataStore.elementColors[elementType] || '#FFFFFF';
        }
        
        // è·å–BOSSé¢œè‰²
        function getBossColor(bossName) {
            const boss = DataStore.bosses.find(b => b.name === bossName);
            return boss ? getElementColor(boss.element) : '#6b7280';
        }
        
        // è·å–è§’è‰²é¢œè‰²
        function getCharacterColor(characterName) {
            const character = DataStore.characters.find(char => char.name === characterName);
            return character ? getElementColor(character.element) : '#FFFFFF';
        }
        
        
        
        // æ ¹æ®çŠ¶æ€è·å–è®°å½•
        function getRecordsByStatus(status) {
            switch (status) {
                case 'all':
                    return DataStore.getAllRecords();
                case 'pending':
                    return DataStore.getPendingRecords();
                case 'approved':
                default:
                    return DataStore.getApprovedRecords();
            }
        }
        
        // åˆå§‹åŒ–é¡µé¢
        async function initPage() {
            try {
                // æ£€æŸ¥DataStoreæ˜¯å¦å·²åŠ è½½
                if (typeof DataStore === 'undefined') {
                    throw new Error('DataStoreæ¨¡å—æœªåŠ è½½');
                }
                
                console.log('DataStoreåŠ è½½æˆåŠŸ');
                console.log('è§’è‰²æ•°é‡:', DataStore.characters.length);
                console.log('BOSSæ•°é‡:', DataStore.bosses.length);
                
                // æ ¹æ®çŠ¶æ€ç­›é€‰è·å–è®°å½•
                const statusFilter = document.getElementById('status-filter') ? document.getElementById('status-filter').value : 'approved';
                allRecords = getRecordsByStatus(statusFilter);
                filteredRecords = [...allRecords];
                
                console.log(`${statusFilter}è®°å½•æ•°é‡:`, allRecords.length);
                
                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                updateStatistics();
                
                // åŠ¨æ€ç”ŸæˆBOSSç­›é€‰é€‰é¡¹
                populateBossFilter();
                
                // åŠ¨æ€ç”Ÿæˆä¸»Cç­›é€‰é€‰é¡¹
                populateMaincFilter();
                
                // åŠ¨æ€ç”Ÿæˆæ¯èµ›ç­›é€‰é€‰é¡¹
                populateCupFilter();
                
                // æ£€æŸ¥URLå‚æ•°æ˜¯å¦æœ‰BOSSç­›é€‰
                const urlParams = new URLSearchParams(window.location.search);
                const bossParam = urlParams.get('boss');
                
                if (bossParam) {
                    const decodedBossName = decodeURIComponent(bossParam);
                    console.log('URLå‚æ•°ä¸­æŒ‡å®šçš„BOSS:', decodedBossName);
                    
                    // æ£€æŸ¥BOSSæ˜¯å¦å­˜åœ¨
                    const bossExists = DataStore.bosses.some(boss => boss.name === decodedBossName);
                    
                    if (bossExists) {
                        // è®¾ç½®BOSSç­›é€‰å™¨
                        document.getElementById('boss-filter').value = decodedBossName;
                        
                        // åº”ç”¨ç­›é€‰
                        applyFilters();
                        
                        // æ˜¾ç¤ºç­›é€‰æˆåŠŸçš„æç¤º
                        showToast(`å·²ç­›é€‰ ${decodedBossName} çš„é€šå…³è®°å½•`);
                    } else {
                        console.warn('URLå‚æ•°ä¸­çš„BOSSä¸å­˜åœ¨:', decodedBossName);
                    }
                }
                
                // æ›´æ–°è¡¨æ ¼
                updateTable();
                
                // åˆå§‹åŒ–å›¾è¡¨
                initCharts();
                
                // æ˜¾ç¤ºå†…å®¹å®¹å™¨ï¼Œéšè—åŠ è½½å®¹å™¨
                document.getElementById('loading-container').classList.add('hidden');
                document.getElementById('content-container').classList.remove('hidden');
                
                // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œæ˜¾ç¤ºæ— æ•°æ®æç¤º
                if (allRecords.length === 0) {
                    document.getElementById('content-container').classList.add('hidden');
                    document.getElementById('no-data-container').classList.remove('hidden');
                }
                
                // æ·»åŠ çŠ¶æ€ç­›é€‰å˜åŒ–äº‹ä»¶ç›‘å¬å™¨
                const statusFilterElement = document.getElementById('status-filter');
                if (statusFilterElement) {
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§ç›‘å¬å™¨
                    statusFilterElement.removeEventListener('change', handleStatusFilterChange);
                    // æ·»åŠ æ–°ç›‘å¬å™¨
                    statusFilterElement.addEventListener('change', handleStatusFilterChange);
                }
                
            } catch (error) {
                console.error('åˆå§‹åŒ–é¡µé¢å¤±è´¥:', error);
                document.getElementById('loading-container').innerHTML = `
                    <div class="text-6xl text-genshin-red mb-4">
                        <i class="fa fa-exclamation-triangle"></i>
                    </div>
                    <p class="text-lg text-gray-400 mb-2">æ•°æ®åŠ è½½å¤±è´¥</p>
                    <p class="text-gray-500 max-w-md mx-auto">${error.message}</p>
                    <button id="retry-btn" class="btn-genshin mt-6">
                        <i class="fa fa-refresh mr-1"></i> é‡è¯•
                    </button>
                `;
                
                // æ·»åŠ é‡è¯•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
                document.getElementById('retry-btn').addEventListener('click', initPage);
            }
        }
        
        // å¤„ç†çŠ¶æ€ç­›é€‰å˜åŒ–
        function handleStatusFilterChange() {
            // é‡æ–°åŠ è½½é¡µé¢æ•°æ®
            initPage();
        }
        
        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message) {
            // åˆ›å»ºæç¤ºå…ƒç´ 
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-genshin-yellow text-dark px-4 py-2 rounded-lg shadow-lg z-50 fade-in';
            toast.textContent = message;
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(toast);
            
            // 3ç§’åç§»é™¤
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-10px)';
                toast.style.transition = 'opacity 0.3s, transform 0.3s';
                
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }
        
        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStatistics() {
            // æ€»é€šå…³è®°å½•
            document.getElementById('total-records').textContent = allRecords.length;
            
            // æ›´æ–°æ—¶é—´
            const now = new Date();
            document.getElementById('update-time').textContent = now.toLocaleDateString();
            
            // å‚ä¸ç©å®¶
            const players = [...new Set(allRecords.map(record => record.player))];
            document.getElementById('total-players').textContent = players.length;
            
            // å¹³å‡æ¯äººé€šå…³æ¬¡æ•°
            const avgRecordsPerPlayer = (allRecords.length / players.length).toFixed(1);
            document.getElementById('avg-records-per-player').textContent = avgRecordsPerPlayer;
            
            // BOSSæ•°é‡
            document.getElementById('total-bosses').textContent = DataStore.bosses.length;
            
            // æœ€éš¾BOSSï¼ˆå¹³å‡é€šå…³æ—¶é—´æœ€é•¿çš„ï¼‰
            const bossTimes = {};
            allRecords.forEach(record => {
                if (!bossTimes[record.boss]) {
                    bossTimes[record.boss] = {
                        total: 0,
                        count: 0
                    };
                }
                bossTimes[record.boss].total += record.time;
                bossTimes[record.boss].count += 1;
            });
            
            let hardestBoss = '';
            let maxAvgTime = 0;
            
            for (const boss in bossTimes) {
                const avgTime = bossTimes[boss].total / bossTimes[boss].count;
                if (avgTime > maxAvgTime) {
                    maxAvgTime = avgTime;
                    hardestBoss = boss;
                }
            }
            
            document.getElementById('hardest-boss').textContent = hardestBoss || 'æš‚æ— æ•°æ®';
            
            // å¹³å‡é€šå…³æ—¶é—´
            if (allRecords.length > 0) {
                const totalTime = allRecords.reduce((sum, record) => sum + record.time, 0);
                const avgTime = Math.round(totalTime / allRecords.length);
                document.getElementById('avg-time').textContent = avgTime;
                
                // æœ€å¿«è®°å½•
                const fastestRecord = allRecords.reduce((fastest, record) => {
                    return record.time < fastest.time ? record : fastest;
                }, allRecords[0]);
                
                document.getElementById('fastest-time').textContent = `${fastestRecord.time} (${fastestRecord.player})`;
            }
        }
        
        // åŠ¨æ€ç”ŸæˆBOSSç­›é€‰é€‰é¡¹
        function populateBossFilter() {
            const bossFilter = document.getElementById('boss-filter');
            
            // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™"å…¨éƒ¨BOSS"ï¼‰
            while (bossFilter.options.length > 1) {
                bossFilter.remove(1);
            }
            
            // æ·»åŠ BOSSé€‰é¡¹
            DataStore.bosses.forEach(boss => {
                const option = document.createElement('option');
                option.value = boss.name;
                option.textContent = boss.name;
                bossFilter.appendChild(option);
            });
        }
        
        // åŠ¨æ€ç”Ÿæˆä¸»Cç­›é€‰é€‰é¡¹
        function populateMaincFilter() {
            const maincFilter = document.getElementById('mainc-filter');
            
            // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™"å…¨éƒ¨ä¸»C"ï¼‰
            while (maincFilter.options.length > 1) {
                maincFilter.remove(1);
            }
            
            // è·å–æ‰€æœ‰ä¸»Cè§’è‰²
            const maincCharacters = [...new Set(allRecords.map(record => record.mainc))];
            
            // æ·»åŠ ä¸»Cé€‰é¡¹
            maincCharacters.forEach(mainc => {
                const option = document.createElement('option');
                option.value = mainc;
                option.textContent = mainc;
                maincFilter.appendChild(option);
            });
        }
        
        // åŠ¨æ€ç”Ÿæˆæ¯èµ›ç­›é€‰é€‰é¡¹
        function populateCupFilter() {
            const cupFilter = document.getElementById('cup-filter');
            
            // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™"å…¨éƒ¨æ¯èµ›"ï¼‰
            while (cupFilter.options.length > 1) {
                cupFilter.remove(1);
            }
            
            // æ·»åŠ æ¯èµ›é€‰é¡¹
            if (DataStore && DataStore.cups) {
                DataStore.cups.forEach(cup => {
                    const option = document.createElement('option');
                    option.value = cup;
                    option.textContent = cup;
                    cupFilter.appendChild(option);
                });
            } else {
                // å¦‚æœDataStore.cupsä¸å¯ç”¨ï¼Œä½¿ç”¨é»˜è®¤é€‰é¡¹
                const defaultCups = ['æ— ', 'æ–°æœˆæ¯'];
                defaultCups.forEach(cup => {
                    const option = document.createElement('option');
                    option.value = cup;
                    option.textContent = cup;
                    cupFilter.appendChild(option);
                });
            }
        }
        
        // åº”ç”¨ç­›é€‰
        function applyFilters() {
            const bossFilter = document.getElementById('boss-filter').value;
            const maincFilter = document.getElementById('mainc-filter').value;
            const goldMin = parseInt(document.getElementById('gold-min').value) || 0;
            const goldMax = parseInt(document.getElementById('gold-max').value) || 48;
            const timeMin = parseInt(document.getElementById('time-min').value) || 0;
            const timeMax = parseInt(document.getElementById('time-max').value) || 360;
            const searchInput = document.getElementById('search-input').value.toLowerCase();
            const statusFilter = document.getElementById('status-filter').value;
            const cupFilter = document.getElementById('cup-filter').value;
            maincRecordFilter = document.getElementById('mainc-record-filter').value;
            
            filteredRecords = allRecords.filter(record => {
                // BOSSç­›é€‰
                if (bossFilter !== 'all' && record.boss !== bossFilter) {
                    return false;
                }
                
                // ä¸»Cç­›é€‰
                if (maincFilter !== 'all' && record.mainc !== maincFilter) {
                    return false;
                }
                
                // äº”æ˜Ÿæ•°èŒƒå›´ç­›é€‰
                let goldCount = 0;
                if (typeof record.gold === 'number') {
                    goldCount = record.gold;
                } else if (record.gold.includes('+')) {
                    const parts = record.gold.split('+');
                    goldCount = parts.reduce((sum, part) => {
                        const num = parseInt(part.replace(/[^\d]/g, '')) || 0;
                        return sum + num;
                    }, 0);
                } else {
                    goldCount = parseInt(record.gold.replace(/[^\d]/g, '')) || 0;
                }
                
                if (goldCount < goldMin || goldCount > goldMax) {
                    return false;
                }
                
                // æ—¶é—´èŒƒå›´ç­›é€‰
                if (record.time < timeMin || record.time > timeMax) {
                    return false;
                }
                
                // è®°å½•çŠ¶æ€ç­›é€‰
                if (statusFilter === 'approved' && record.status !== 'approved') {
                    return false;
                } else if (statusFilter === 'pending' && record.status !== 'pending') {
                    return false;
                }
                
                // æ¯èµ›ç­›é€‰
                if (cupFilter !== 'all' && (record.cup || 'æ— ') !== cupFilter) {
                    return false;
                }
                
                // æœç´¢ç­›é€‰
                if (searchInput && !(
                    record.player.toLowerCase().includes(searchInput) ||
                    (record.notes && record.notes.toLowerCase().includes(searchInput))
                )) {
                    return false;
                }
                
                return true;
            });
            
            // åº”ç”¨ä¸»Cè®°å½•ç­›é€‰
            if (maincRecordFilter === 'best') {
                const maincBestRecords = {};
                
                // å…ˆå¯¹è®°å½•è¿›è¡Œæ’åºï¼Œç¡®ä¿æœ€ä¼˜è®°å½•åœ¨å‰é¢
                const sortedRecords = [...filteredRecords];
                // å…³é”®ï¼šæ¥æ”¶sortRecordsçš„è¿”å›å€¼ï¼Œå› ä¸ºé»˜è®¤æ’åºä¼šè¿”å›æ–°æ•°ç»„
                const sortedResult = sortRecords(sortedRecords);
                // å¦‚æœæœ‰è¿”å›å€¼å°±ä½¿ç”¨è¿”å›å€¼ï¼Œå¦åˆ™ä½¿ç”¨åŸå§‹æ•°ç»„
                const finalSortedRecords = sortedResult || sortedRecords;
                
                // æ¯ä¸ªä¸»Cåªä¿ç•™æœ€ä¼˜è®°å½•
                finalSortedRecords.forEach(record => {  // <-- ä½¿ç”¨æ­£ç¡®æ’åºåçš„æ•°ç»„
                    const mainc = record.mainc?.toLowerCase() || '';
                    if (!maincBestRecords[mainc]) {
                        maincBestRecords[mainc] = record;
                    }
                });
                
                filteredRecords = Object.values(maincBestRecords);
            }
            
            // é‡ç½®é¡µç 
            currentPage = 1;
            
            // æ›´æ–°è¡¨æ ¼
            updateTable();
            
            // æ›´æ–°å›¾è¡¨
            initCharts();
            
            // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œæ˜¾ç¤ºæ— æ•°æ®æç¤º
            if (filteredRecords.length === 0) {
                document.getElementById('content-container').classList.add('hidden');
                document.getElementById('no-data-container').classList.remove('hidden');
            } else {
                document.getElementById('content-container').classList.remove('hidden');
                document.getElementById('no-data-container').classList.add('hidden');
            }
        }
        
        // é‡ç½®ç­›é€‰
        function resetFilters() {
            document.getElementById('boss-filter').value = 'all';
            document.getElementById('mainc-filter').value = 'all';
            document.getElementById('gold-min').value = '0';
            document.getElementById('gold-max').value = '48';
            document.getElementById('time-min').value = '0';
            document.getElementById('time-max').value = '360';
            document.getElementById('search-input').value = '';
            document.getElementById('status-filter').value = 'approved';
            document.getElementById('cup-filter').value = 'all';
            document.getElementById('mainc-record-filter').value = 'all';
            maincRecordFilter = 'all';
            
            // é‡æ–°åŠ è½½è®°å½•
            initPage();
        }
        
        // æ›´æ–°è¡¨æ ¼
        function updateTable() {
            console.log('æ›´æ–°è¡¨æ ¼ - å½“å‰é¡µç :', currentPage);
            console.log('ç­›é€‰åè®°å½•æ•°é‡:', filteredRecords.length);
            
            // æ’åºè®°å½•
            const sortedRecords = sortRecords([...filteredRecords]);
            
            // åˆ†é¡µ
            const startIndex = (currentPage - 1) * recordsPerPage;
            const endIndex = Math.min(startIndex + recordsPerPage, sortedRecords.length);
            const pageRecords = sortedRecords.slice(startIndex, endIndex);
            
            console.log('å½“å‰é¡µè®°å½•æ•°é‡:', pageRecords.length);
            
            // æ›´æ–°è¡¨æ ¼å†…å®¹
            const tableBody = document.getElementById('records-table-body');
            tableBody.innerHTML = '';
            
            pageRecords.forEach((record, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-800 fade-in';
                row.style.animationDelay = `${index * 0.05}s`;
                
                // æ’å
                const rankCell = document.createElement('td');
                rankCell.className = 'text-center';
                
                // å‰ä¸‰åæ˜¾ç¤ºç‰¹æ®Šå›¾æ ‡
                if (startIndex + index < 3) {
                    const ranks = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
                    rankCell.innerHTML = `<div class="font-bold text-xl">${ranks[startIndex + index]}</div>`;
                } else {
                    rankCell.innerHTML = `<div class="text-gray-400">${startIndex + index + 1}</div>`;
                }
                
                row.appendChild(rankCell);
                
                // ç©å®¶
                const playerCell = document.createElement('td');
                playerCell.innerHTML = `<div class="font-medium">${record.player}</div>`;
                row.appendChild(playerCell);
                
                // ä¸»C
                const maincCell = document.createElement('td');
                const maincColor = getCharacterColor(record.mainc);
                maincCell.innerHTML = `
                    <div class="flex items-center">
                        <div class="relative">
                            <img src="${getCharacterAvatarUrl(record.mainc)}" alt="${record.mainc}" class="avatar-sm mr-2">
                        </div>
                        <span style="color: ${maincColor}">${record.mainc}</span>
                    </div>
                `;
                row.appendChild(maincCell);
                
                // é˜Ÿä¼é…ç½®
                const teamCell = document.createElement('td');
                const teamAvatars = record.team.map(char => {
                    // è·å–å‘½åº§æ•°å­—ï¼ˆå¤„ç†å¯èƒ½ç¼ºå¤±çš„å±æ€§ï¼‰
                    const constellationNum = char.constellation !== undefined ? char.constellation : 0;
                    // è·å–æ­¦å™¨ç²¾ç‚¼ç­‰çº§ï¼ˆå¤„ç†å¯èƒ½ç¼ºå¤±çš„å±æ€§ï¼‰
                    const weaponLevel = char.weapon !== undefined ? char.weapon : 0;
                    // å¦‚æœå‘½åº§ä¸º0ï¼Œä¸æ˜¾ç¤ºå‘½åº§æ•°å­—
                    const constellationBadge = constellationNum > 0 ? 
                        `<div class="absolute bottom-0 right-0 bg-genshin-yellow text-dark text-xs font-bold rounded-full w-4 h-4 flex items-center justify-center">${constellationNum}</div>` : '';
                    // å¦‚æœæ­¦å™¨ç²¾ç‚¼ç­‰çº§å¤§äº0ï¼Œæ˜¾ç¤ºæ­¦å™¨å›¾æ ‡å’Œç²¾ç‚¼ç­‰çº§
                    const weaponBadge = weaponLevel > 0 ? 
                        `<div class="absolute top-0 right-0 bg-genshin-blue text-white text-xs font-bold rounded-full w-4 h-4 flex items-center justify-center">${weaponLevel}</div>` : '';
                    
                    const charColor = getCharacterColor(char.character);
                    const elementIndicator = '';
                    
                    return `
                        <div class="relative">
                            <img src="${getCharacterAvatarUrl(char.character)}" alt="${char.character}" class="avatar-sm" title="${char.character} (${constellationNum}å‘½, ç²¾${weaponLevel})">
                            ${elementIndicator}
                            ${constellationBadge}
                            ${weaponBadge}
                        </div>
                    `;
                }).join('');
                
                teamCell.innerHTML = `
                    <div class="team-avatars">
                        ${teamAvatars}
                    </div>
                `;
                row.appendChild(teamCell);
                
                // äº”æ˜Ÿæ•°
                const goldCell = document.createElement('td');
                goldCell.innerHTML = `<div class="badge badge-gold">${record.gold}é‡‘</div>`;
                row.appendChild(goldCell);
                
                // å¸¸é©»é‡‘
                const constgoldCell = document.createElement('td');
                constgoldCell.innerHTML = `<div class="badge badge-gold">${record.constgold || 0}é‡‘</div>`;
                row.appendChild(constgoldCell);
                
                // é€šå…³æ—¶é—´
                const timeCell = document.createElement('td');
                let timeClass = 'badge-time';
                if (record.time < 100) {
                    timeClass = 'badge-fast';
                } else if (record.time > 115) {
                    timeClass = 'badge-slow';
                }
                
                timeCell.innerHTML = `<div class="badge ${timeClass}">${record.time}ç§’</div>`;
                row.appendChild(timeCell);
                
                // BOSS
                const bossCell = document.createElement('td');
                bossCell.innerHTML = `
                    <div class="flex items-center">
                        <img src="${getBossAvatarUrl(record.boss)}" alt="${record.boss}" class="avatar-md">
                    </div>
                `;
                row.appendChild(bossCell);
                
                // å¤‡æ³¨
                const notesCell = document.createElement('td');
                if (record.notes) {
                    // å¦‚æœå¤‡æ³¨è¾ƒé•¿ï¼Œæ˜¾ç¤ºå‰20ä¸ªå­—ç¬¦å¹¶æ·»åŠ çœç•¥å·
                    const displayNotes = record.notes.length > 20 ? 
                        `${record.notes.substring(0, 20)}...` : record.notes;
                    
                    notesCell.innerHTML = `
                        <div class="relative">
                            <span class="text-gray-300">${displayNotes}</span>
                            ${record.notes.length > 20 ? 
                                `<i class="fa fa-ellipsis-h text-gray-500 cursor-help" title="${record.notes}"></i>` : ''}
                        </div>
                    `;
                } else {
                    notesCell.innerHTML = '<span class="text-gray-500">-</span>';
                }
                row.appendChild(notesCell);
                
                // æ“ä½œ
                const actionCell = document.createElement('td');
                // å¤„ç†è§†é¢‘é“¾æ¥ï¼Œå¦‚æœä»¥www.å¼€å¤´åˆ™æ·»åŠ https://å‰ç¼€
                let videoLink = record.video || '';
                if (videoLink && videoLink.startsWith('www.')) {
                    videoLink = 'https://' + videoLink;
                }
                if (videoLink) {
                    actionCell.innerHTML = `
                        <div class="flex space-x-2">
                            <a href="${videoLink}" target="_blank" class="text-genshin-blue hover:text-genshin-yellow transition-colors" title="è§‚çœ‹è§†é¢‘">
                                <i class="fa fa-play-circle"></i>
                            </a>
                        </div>
                    `;
                } else {
                    actionCell.innerHTML = '-';
                }
                row.appendChild(actionCell);
                
                tableBody.appendChild(row);
            });
            
            // æ›´æ–°åˆ†é¡µä¿¡æ¯
            document.getElementById('showing-records').textContent = pageRecords.length;
            document.getElementById('filtered-records-count').textContent = sortedRecords.length;
            
            // æ›´æ–°åˆ†é¡µæŒ‰é’®çŠ¶æ€
            document.getElementById('prev-page').disabled = currentPage === 1;
            document.getElementById('next-page').disabled = endIndex >= sortedRecords.length;
            
            // æ›´æ–°é¡µç æŒ‰é’®
            updatePageButtons();
        }
        
        // æ›´æ–°é¡µç æŒ‰é’®
        function updatePageButtons() {
            const pageButtonsContainer = document.getElementById('pagination-buttons');
            pageButtonsContainer.innerHTML = '';
            
            const totalPages = Math.ceil(filteredRecords.length / recordsPerPage);
            const maxVisiblePages = 5;
            
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const button = document.createElement('button');
                button.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                button.textContent = i;
                button.addEventListener('click', function() {
                    currentPage = i;
                    updateTable();
                });
                pageButtonsContainer.appendChild(button);
            }
        }
        
        // æ’åºè®°å½•
        function sortRecords(records) {
            // é»˜è®¤æ’åºï¼šåŒä¸»Cæ”¾åœ¨ä¸€èµ·ï¼ŒæŒ‰é™å®šé‡‘æ•°ã€å¸¸é©»é‡‘æ•°ã€é€šå…³æ—¶é—´ä»å°åˆ°å¤§æ’åº
            if (sortField === 'gold' && sortDirection === 'asc') {
                // æ­¥éª¤1ï¼šå°†è®°å½•æŒ‰ä¸»Cåˆ†ç»„
                const maincGroups = {};
                records.forEach(record => {
                    const mainc = record.mainc?.toLowerCase() || '';
                    if (!maincGroups[mainc]) {
                        maincGroups[mainc] = [];
                    }
                    maincGroups[mainc].push(record);
                });
                
                // æ­¥éª¤2ï¼šå¯¹æ¯ä¸ªä¸»Cç»„å†…çš„è®°å½•è¿›è¡Œå†…éƒ¨æ’åº
                Object.keys(maincGroups).forEach(mainc => {
                    maincGroups[mainc].sort((a, b) => {
                        // é™å®šé‡‘æ•°æ’åº
                        let goldA = typeof a.gold === 'number' ? a.gold : 
                                   a.gold?.includes('+') ? a.gold.split('+').reduce((sum, part) => sum + parseInt(part.replace(/[^\d]/g, '') || 0), 0) :
                                   parseInt(a.gold?.replace(/[^\d]/g, '')) || 0;
                                
                        let goldB = typeof b.gold === 'number' ? b.gold : 
                                   b.gold?.includes('+') ? b.gold.split('+').reduce((sum, part) => sum + parseInt(part.replace(/[^\d]/g, '') || 0), 0) :
                                   parseInt(b.gold?.replace(/[^\d]/g, '')) || 0;
                        if (goldA !== goldB) return goldA - goldB;
                        
                        // å¸¸é©»é‡‘æ•°æ’åº
                        let constGoldA = a.constgold || 0;
                        let constGoldB = b.constgold || 0;
                        if (constGoldA !== constGoldB) return constGoldA - constGoldB;
                        
                        // é€šå…³æ—¶é—´æ’åº
                        return (a.time || 0) - (b.time || 0);
                    });
                });
                
                // æ­¥éª¤3ï¼šå¯¹ä¸»Cç»„è¿›è¡Œæ’åºï¼ˆæŒ‰ç…§æ¯ä¸ªä¸»Cç»„ä¸­ä¼˜å…ˆçº§æœ€é«˜çš„è®°å½•ï¼‰
                const sortedMaincGroups = Object.values(maincGroups).sort((groupA, groupB) => {
                    // å–æ¯ä¸ªç»„ä¸­ä¼˜å…ˆçº§æœ€é«˜çš„è®°å½•ï¼ˆç»„å†…å·²æ’åºï¼Œç¬¬ä¸€æ¡å°±æ˜¯æœ€é«˜ä¼˜å…ˆçº§ï¼‰
                    const recordA = groupA[0];
                    const recordB = groupB[0];
                    
                    // é™å®šé‡‘æ•°æ’åº
                    let goldA = typeof recordA.gold === 'number' ? recordA.gold : 
                               recordA.gold?.includes('+') ? recordA.gold.split('+').reduce((sum, part) => sum + parseInt(part.replace(/[^\d]/g, '') || 0), 0) :
                               parseInt(recordA.gold?.replace(/[^\d]/g, '')) || 0;
                                
                    let goldB = typeof recordB.gold === 'number' ? recordB.gold : 
                               recordB.gold?.includes('+') ? recordB.gold.split('+').reduce((sum, part) => sum + parseInt(part.replace(/[^\d]/g, '') || 0), 0) :
                               parseInt(recordB.gold?.replace(/[^\d]/g, '')) || 0;
                    if (goldA !== goldB) return goldA - goldB;
                    
                    // å¸¸é©»é‡‘æ•°æ’åº
                    let constGoldA = recordA.constgold || 0;
                    let constGoldB = recordB.constgold || 0;
                    if (constGoldA !== constGoldB) return constGoldA - constGoldB;
                    
                    // é€šå…³æ—¶é—´æ’åº
                    return (recordA.time || 0) - (recordB.time || 0);
                });
                
                // æ­¥éª¤4ï¼šå°†æ’åºåçš„ä¸»Cç»„åˆå¹¶
                return sortedMaincGroups.flat();
            }
            
            // å…¶ä»–æ’åºæ–¹å¼
            return records.sort((a, b) => {
                let valueA, valueB;
                
                switch (sortField) {
                    case 'time':
                        valueA = a.time;
                        valueB = b.time;
                        break;
                    case 'gold':
                        // å¤„ç†äº”æ˜Ÿæ•°ï¼ŒåŒ…æ‹¬æ•°å­—å’Œå­—ç¬¦ä¸²æ ¼å¼
                        valueA = typeof a.gold === 'number' ? a.gold : 
                                a.gold?.includes('+') ? a.gold.split('+').reduce((sum, part) => sum + parseInt(part.replace(/[^\d]/g, '') || 0), 0) :
                                parseInt(a.gold?.replace(/[^\d]/g, '')) || 0;
                        
                        valueB = typeof b.gold === 'number' ? b.gold : 
                                b.gold?.includes('+') ? b.gold.split('+').reduce((sum, part) => sum + parseInt(part.replace(/[^\d]/g, '') || 0), 0) :
                                parseInt(b.gold?.replace(/[^\d]/g, '')) || 0;
                        break;
                    case 'constgold':
                        valueA = a.constgold || 0;
                        valueB = b.constgold || 0;
                        break;
                    case 'date':
                        // è§£ææ—¥æœŸ
                        valueA = new Date(a.submitTime);
                        valueB = new Date(b.submitTime);
                        break;
                    case 'player':
                        valueA = a.player.toLowerCase();
                        valueB = b.player.toLowerCase();
                        break;
                    case 'mainc':
                        valueA = a.mainc?.toLowerCase() || '';
                        valueB = b.mainc?.toLowerCase() || '';
                        break;
                    case 'boss':
                        valueA = a.boss.toLowerCase();
                        valueB = b.boss.toLowerCase();
                        break;
                    default:
                        valueA = a[sortField] || '';
                        valueB = b[sortField] || '';
                }
                
                if (valueA < valueB) {
                    return sortDirection === 'asc' ? -1 : 1;
                }
                if (valueA > valueB) {
                    return sortDirection === 'asc' ? 1 : -1;
                }
                return 0;
            });
        }
        
        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            // BOSSé€šå…³æ¬¡æ•°åˆ†å¸ƒ
            const bossCtx = document.getElementById('boss-chart').getContext('2d');
            
            // ç»Ÿè®¡æ¯ä¸ªBOSSçš„é€šå…³æ¬¡æ•°
            const bossCounts = {};
            DataStore.bosses.forEach(boss => {
                bossCounts[boss.name] = 0;
            });
            
            filteredRecords.forEach(record => {
                if (bossCounts[record.boss] !== undefined) {
                    bossCounts[record.boss] = (bossCounts[record.boss] || 0) + 1;
                }
            });
            
            // å‡†å¤‡å›¾è¡¨æ•°æ®
            const bossLabels = Object.keys(bossCounts);
            const bossData = Object.values(bossCounts);
            const bossColors = bossLabels.map(boss => getBossColor(boss));
            
            // é”€æ¯æ—§å›¾è¡¨
            if (window.bossChart) {
                window.bossChart.destroy();
            }
            
            // åˆ›å»ºæ–°å›¾è¡¨
            window.bossChart = new Chart(bossCtx, {
                type: 'bar',
                data: {
                    labels: bossLabels,
                    datasets: [{
                        label: 'é€šå…³æ¬¡æ•°',
                        data: bossData,
                        backgroundColor: bossColors.map(color => `${color}33`), // æ·»åŠ é€æ˜åº¦
                        borderColor: bossColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                maxRotation: 45,
                                minRotation: 45
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(18, 18, 18, 0.9)',
                            titleColor: '#f5f5f5',
                            bodyColor: '#f5f5f5',
                            borderColor: 'rgba(255, 255, 255, 0.2)',
                            borderWidth: 1,
                            padding: 10,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    return `é€šå…³æ¬¡æ•°: ${context.raw}`;
                                }
                            }
                        }
                    }
                }
            });
            
            // ä¸»Cä½¿ç”¨ç‡
            const maincCtx = document.getElementById('mainc-chart').getContext('2d');
            
            // ç»Ÿè®¡æ¯ä¸ªä¸»Cçš„ä½¿ç”¨æ¬¡æ•°
            const maincCounts = {};
            filteredRecords.forEach(record => {
                maincCounts[record.mainc] = (maincCounts[record.mainc] || 0) + 1;
            });
            
            // å‡†å¤‡å›¾è¡¨æ•°æ®
            const maincLabels = Object.keys(maincCounts);
            const maincData = Object.values(maincCounts);
            
            // ç”Ÿæˆé¢œè‰²
            const maincColors = maincLabels.map((_, index) => {
                const colors = [
                    '#7928ca', '#ff0080', '#3b82f6', '#fbbf24', '#10b981', 
                    '#ef4444', '#6b7280', '#14b8a6', '#ec4899', '#8b5cf6'
                ];
                return colors[index % colors.length];
            });
            
            // é”€æ¯æ—§å›¾è¡¨
            if (window.maincChart) {
                window.maincChart.destroy();
            }
            
            // åˆ›å»ºæ–°å›¾è¡¨
            window.maincChart = new Chart(maincCtx, {
                type: 'pie',
                data: {
                    labels: maincLabels,
                    datasets: [{
                        data: maincData,
                        backgroundColor: maincColors.map(color => `${color}cc`), // æ·»åŠ é€æ˜åº¦
                        borderColor: maincColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: 'rgba(255, 255, 255, 0.7)',
                                padding: 10,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(18, 18, 18, 0.9)',
                            titleColor: '#f5f5f5',
                            bodyColor: '#f5f5f5',
                            borderColor: 'rgba(255, 255, 255, 0.2)',
                            borderWidth: 1,
                            padding: 10,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((sum, value) => sum + value, 0);
                                    const percentage = Math.round((context.raw / total) * 100);
                                    return `${context.label}: ${context.raw}æ¬¡ (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            // ç­›é€‰æŒ‰é’®
            document.getElementById('apply-filter').addEventListener('click', applyFilters);
            document.getElementById('reset-filter').addEventListener('click', resetFilters);
            
            // æœç´¢æ¡†å›è½¦äº‹ä»¶
            document.getElementById('search-input').addEventListener('keyup', function(e) {
                if (e.key === 'Enter') {
                    applyFilters();
                }
            });
            
            // æ’åºä¸‹æ‹‰æ¡†
            document.getElementById('sort-select').addEventListener('change', function() {
                const value = this.value;
                const [field, direction] = value.split('-');
                sortField = field;
                sortDirection = direction;
                
                // æ›´æ–°è¡¨å¤´æ ·å¼
                document.querySelectorAll('.sortable-header').forEach(h => {
                    h.classList.remove('asc', 'desc');
                    if (h.getAttribute('data-sort') === field) {
                        h.classList.add(direction);
                    }
                });
                
                updateTable();
            });
            
            // è¡¨å¤´æ’åºç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.sortable-header').forEach(header => {
                header.addEventListener('click', function() {
                    const field = this.getAttribute('data-sort');
                    if (sortField === field) {
                        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                    } else {
                        sortField = field;
                        sortDirection = 'asc';
                    }
                    
                    // æ›´æ–°è¡¨å¤´æ ·å¼
                    document.querySelectorAll('.sortable-header').forEach(h => {
                        h.classList.remove('asc', 'desc');
                    });
                    this.classList.add(sortDirection);
                    
                    // æ›´æ–°æ’åºä¸‹æ‹‰æ¡†
                    document.getElementById('sort-select').value = `${field}-${sortDirection}`;
                    
                    updateTable();
                });
            });
            
            // åˆ†é¡µæŒ‰é’®
            document.getElementById('prev-page').addEventListener('click', function() {
                if (currentPage > 1) {
                    currentPage--;
                    updateTable();
                }
            });
            
            document.getElementById('next-page').addEventListener('click', function() {
                const totalPages = Math.ceil(filteredRecords.length / recordsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    updateTable();
                }
            });
            
            
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initEventListeners();
            initPage();
        });
    </script>
</body>
</html>
